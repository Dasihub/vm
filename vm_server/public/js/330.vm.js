(self.webpackChunkclient=self.webpackChunkclient||[]).push([[330],{7569:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>O});var i=t(5893),n=t(7294),a=t(5248),l=t(1423),r=t(7116),c=t(927),d=t(7026),o=t(3932),u=t(7869),m=t(9948),h=t(7484),j=t.n(h),g=t(1491),p=function(e,s,t,i){return new(t||(t=Promise))((function(n,a){function l(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var s;e.done?n(e.value):(s=e.value,s instanceof t?s:new t((function(e){e(s)}))).then(l,r)}c((i=i.apply(e,s||[])).next())}))};const _=({groups:e,vidZanyatie:s,idDiscipline:t,isSelect:l,discipline:h,credit:_,idGroup:x,idWs:v,idYear:f,idVidZanyatie:b,back:y})=>{const{request:O}=(0,c.i)(),N=(0,g.U)(),[w,S]=n.useState([]),{id_user:k}=(0,d.X)((e=>e.authReducer)),{years:$}=(0,d.X)((e=>e.yearReducer)),{ws:C}=(0,d.X)((e=>e.wsReducer)),{surname:R,name:Z,patronymic:z}=(0,d.X)((e=>e.userInfoReducer)),D=n.useRef(null),[F,X]=n.useState([]),[Y,E]=n.useState(!1),[P,G]=n.useState(!1),[M,V]=n.useState(!1),[W,I]=n.useState("");console.log(w,"report");const T=(0,m.t)(F,"dates"),q=()=>p(void 0,void 0,void 0,(function*(){E(!0);const{data:e}=yield O(`/reports/journal?year=${f}&id_ws=${v}&discipline=${t}&credit=${_}&group=${x}&id_teacher=${k}&id_vid_zaniatiy=${b}&isSelect=${l}`);if(E(!1),!e.length)return G(!0);let s=e.reduce(((e,s)=>(e[s.s_fio]=e[s.s_fio]||[],e[s.s_fio].push({date:s.dates,otsenka:s.otsenka,timesCount:s.timesCount}),e)),{}),i=Object.keys(s),n=[],a={item:0,count:0};for(let s=0;s<e.length;s++){let t=e.filter((t=>t.s_fio===e[s].s_fio)).length;t>a.count&&(a={item:e[s],count:e.filter((t=>t.s_fio===e[s].s_fio)).length})}let{item:r,count:c}=a,d={name:"ФИО студента"};for(let e=0;e<c;e++)d["date_"+e]=s[r.s_fio][e].date;d.nb_Count="Всего н/б",d.ball_Count="Общая сумма",d.ball_average="Средняя оценка",n.push(d);for(let t=0;t<i.length;t++){let a={name:i[t]},l=0,d=0,o=null;s[r.s_fio].map(((e,n)=>{o=s[i[t]].filter((s=>s.date==e.date&&s.timesCount==e.timesCount))[0],a["date_"+n]=o?o.otsenka:null}));for(let e=0;e<c;e++)s[i[t]][e]&&("н/б"==s[i[t]][e].otsenka?l+=1:d+=null==s[i[t]][e].otsenka?0:parseInt(s[i[t]][e].otsenka));a.nb_Count=l,a.ball_Count=d,a.ball_average=Math.round(100*d/c)/100,n.push(a),X(e),S(n)}})),A=(0,r.useReactToPrint)({content:()=>D.current}),J=e=>{I(e),V(!0)};return n.useEffect((()=>{Z.length&&q()}),[Z]),Y?(0,i.jsx)("div",Object.assign({className:"vh-100 flex justify-content-center align-items-center"},{children:(0,i.jsx)(a.aN,{})})):(0,i.jsxs)(i.Fragment,{children:[M&&(0,i.jsx)(a.bZ,{hide:V.bind(null,!1),confirm:()=>p(void 0,void 0,void 0,(function*(){V(!1);const{timesCount:e,id_discipline:s,id_semesterOrWs:t,id_vid_zaniatiy:i,credits:n,visitDate:a}=T[W][0],l=j()(a).format("YYYY-MM-DD"),{data:r}=yield O(`/reports/journal/?id_teacher=${k}&id_discipline=${s}&credit=${n}&visitDate=${l}&id_groupOrPorok=${x}&id_year=${f}&id_ws=${v}&id_semesterOrWs=${t}&id_vid_zaniatiy=${i}&timesCount=${e}`,"DELETE");N(null==r?void 0:r.SMS_T_StudentJournalVisit_delete,"success"),q()}))}),(0,i.jsxs)("div",Object.assign({className:"m-l-r-2 flex align-items-center gap-1"},{children:[(0,i.jsx)("i",{className:"fa-solid fa-arrow-left-long color-primary",onClick:y,style:{cursor:"pointer",fontSize:"30px"}}),P?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{onClick:()=>{const e=u.utils.json_to_sheet(w);console.log({ws:e})},style:{cursor:"pointer",width:"40px"},src:o.XO,alt:"exel"}),(0,i.jsx)("img",{onClick:A,style:{cursor:"pointer",width:"40px"},src:o.Kh,alt:"print"})]})]})),(0,i.jsxs)("div",Object.assign({className:"print_container box_container mt-2",ref:D},{children:[(0,i.jsx)("h1",Object.assign({className:"head_title"},{children:"ЖУРНАЛ УЧЕТА ЗАНЯТИЙ"})),P?(0,i.jsx)("p",Object.assign({className:"text-center mt-4"},{children:"Пока нет данных!"})):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",Object.assign({className:"mt-3 m-l-r-2"},{children:["Преподаватель:"," ",(0,i.jsxs)("strong",{children:[R," ",Z," ",z]})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Учебный год:"," ",(0,i.jsx)("strong",{children:$.map((e=>e.id_a_year===f?e.p32:null))})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Полугодие/Семестр: ",(0,i.jsx)("strong",{children:C.map((e=>e.id_ws===v?e.ws:null))})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Факультет/Группа:"," ",(0,i.jsx)("strong",{children:e.map((e=>e.id_group===x?e.groups:null))})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Дисциплина: ",(0,i.jsx)("strong",{children:h})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Вид занятий:"," ",(0,i.jsx)("strong",{children:s.map((e=>e.id_vid_zaniatiy===b?e.name_vid_zaniatiy:null))})]})),(0,i.jsx)("div",Object.assign({className:"mt-4 m-l-r-2 overflow-auto"},{children:(0,i.jsx)("table",Object.assign({className:"table"},{children:(0,i.jsx)("tbody",{children:w.map(((e,s)=>{let t=Object.keys(e);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("tr",{children:s?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("td",Object.assign({className:"text-center"},{children:s})),t.map(((s,t)=>(0,i.jsx)("td",Object.assign({style:"name"==s?{textAlign:"left",paddingLeft:"10px"}:{textAlign:"center"}},{children:e[s]?e[s]:"-"}),t)))]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("th",Object.assign({className:"bg-color-primary"},{children:"№"})),t.map(((s,t)=>s.includes("date_")?(0,i.jsxs)("th",Object.assign({className:"bg-color-primary"},{children:[" ",(0,i.jsx)("i",{onClick:J.bind(null,e[s]),style:{color:"white",marginRight:"8px"},className:"fa fa-pencil pointer"})," ",e[s]?e[s]:"-"]}),t):(0,i.jsx)("th",Object.assign({className:"bg-color-primary"},{children:e[s]?e[s]:"-"}),t)))]})},s)})}))})}))}))]})]}))]})};var x=t(2724),v=t(6770),f=t(1275),b=t(5998),y=t(4504);const O=()=>{const e=(0,b.I0)(),{id_role:s}=(0,d.X)((e=>e.authReducer)),{role1:t}=f.G.actions,[r,c]=n.useState(1),[o,u]=n.useState(!1),[m,h]=n.useState(),[j,g]=n.useState({v_year:null,v_group:null,v_vid_zanyatie:null,v_ws:null}),[p,O]=n.useState([]),[N,w]=n.useState([]);return n.useEffect((()=>{s!=y.Z_&&e(t())}),[]),o?(0,i.jsx)(_,{groups:p,vidZanyatie:N,credit:null==m?void 0:m.Krdt,isSelect:null==m?void 0:m.isSelect,discipline:null==m?void 0:m.discipline,idDiscipline:null==m?void 0:m.id_discipline,idYear:null==j?void 0:j.v_year,idGroup:null==j?void 0:j.v_group,idVidZanyatie:j.v_vid_zanyatie,idWs:j.v_ws,back:u.bind(null,!1)}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",Object.assign({className:x.Z.tab},{children:(0,i.jsx)(a.mQ,{isPage:r,data:v.qx,changePage:c})})),1==r?(0,i.jsx)(l.J$,{toReport:(e,s)=>{u(!0),g(s),h(e)},vidZanyatie:N,setVidZanyatie:w,groups:p,setGroups:O}):(0,i.jsx)(l.wp,{})]})}},5382:()=>{},2095:()=>{},1219:()=>{}}]);