(self.webpackChunkclient=self.webpackChunkclient||[]).push([[330],{7569:(e,i,t)=>{"use strict";t.r(i),t.d(i,{default:()=>j});var l=t(5893),s=t(7294),a=t(1824),n=t(7026),u=t(927),d=t(1491),r=t(5256),o=t(7116),c=t(471),v=t(7869),_=t(9948),g=t(7484),b=t.n(g),p=function(e,i,t,l){return new(t||(t=Promise))((function(s,a){function n(e){try{d(l.next(e))}catch(e){a(e)}}function u(e){try{d(l.throw(e))}catch(e){a(e)}}function d(e){var i;e.done?s(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(n,u)}d((l=l.apply(e,i||[])).next())}))};const m=({groups:e,vidZanyatie:i,idDiscipline:t,isSelect:r,discipline:g,credit:m,idGroup:h,idWs:j,idYear:y,idVidZanyatie:O,back:f})=>{const{request:x}=(0,u.i)(),$=(0,d.U)(),[S,k]=s.useState([]),{id_user:w}=(0,n.X)((e=>e.authReducer)),{years:N}=(0,n.X)((e=>e.yearReducer)),{ws:z}=(0,n.X)((e=>e.wsReducer)),{surname:C,name:D,patronymic:P}=(0,n.X)((e=>e.userInfoReducer)),Y=s.useRef(null),[M,R]=s.useState([]),[W,V]=s.useState(!1),[Z,G]=s.useState(!1),[T,X]=s.useState(!1),[E,F]=s.useState("");console.log(S,"report");const K=(0,_.t)(M,"dates"),A=()=>p(void 0,void 0,void 0,(function*(){V(!0);const{data:e}=yield x(`/reports/journal?year=${y}&id_ws=${j}&discipline=${t}&credit=${m}&group=${h}&id_teacher=${w}&id_vid_zaniatiy=${O}&isSelect=${r}`);if(V(!1),!e.length)return G(!0);let i=e.reduce(((e,i)=>(e[i.s_fio]=e[i.s_fio]||[],e[i.s_fio].push({date:i.dates,otsenka:i.otsenka,timesCount:i.timesCount}),e)),{}),l=Object.keys(i),s=[],a={item:0,count:0};for(let i=0;i<e.length;i++){let t=e.filter((t=>t.s_fio===e[i].s_fio)).length;t>a.count&&(a={item:e[i],count:e.filter((t=>t.s_fio===e[i].s_fio)).length})}let{item:n,count:u}=a,d={name:"ФИО студента"};for(let e=0;e<u;e++)d["date_"+e]=i[n.s_fio][e].date;d.nb_Count="Всего н/б",d.ball_Count="Общая сумма",d.ball_average="Средняя оценка",s.push(d);for(let t=0;t<l.length;t++){let a={name:l[t]},d=0,r=0,o=null;i[n.s_fio].map(((e,s)=>{o=i[l[t]].filter((i=>i.date==e.date&&i.timesCount==e.timesCount))[0],a["date_"+s]=o?o.otsenka:null}));for(let e=0;e<u;e++)i[l[t]][e]&&("н/б"==i[l[t]][e].otsenka?d+=1:r+=null==i[l[t]][e].otsenka?0:parseInt(i[l[t]][e].otsenka));a.nb_Count=d,a.ball_Count=r,a.ball_average=Math.round(100*r/u)/100,s.push(a),R(e),k(s)}})),q=(0,o.useReactToPrint)({content:()=>Y.current}),I=e=>{F(e),X(!0)};return s.useEffect((()=>{D.length&&A()}),[D]),W?(0,l.jsx)("div",Object.assign({className:"vh-100 flex justify-content-center align-items-center"},{children:(0,l.jsx)(a.aN,{})})):(0,l.jsxs)(l.Fragment,{children:[T&&(0,l.jsx)(a.bZ,{hide:X.bind(null,!1),confirm:()=>p(void 0,void 0,void 0,(function*(){X(!1);const{timesCount:e,id_discipline:i,id_semesterOrWs:t,id_vid_zaniatiy:l,credits:s,visitDate:a}=K[E][0],n=b()(a).format("YYYY-MM-DD"),{data:u}=yield x(`/reports/journal/?id_teacher=${w}&id_discipline=${i}&credit=${s}&visitDate=${n}&id_groupOrPorok=${h}&id_year=${y}&id_ws=${j}&id_semesterOrWs=${t}&id_vid_zaniatiy=${l}&timesCount=${e}`,"DELETE");$(null==u?void 0:u.SMS_T_StudentJournalVisit_delete,"success"),A()}))}),(0,l.jsxs)("div",Object.assign({className:"m-l-r-2 flex align-items-center gap-1"},{children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-left-long color-primary",onClick:f,style:{cursor:"pointer",fontSize:"30px"}}),Z?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("img",{onClick:()=>{const e=v.utils.json_to_sheet(S);console.log({ws:e})},style:{cursor:"pointer",width:"40px"},src:c.XO,alt:"exel"}),(0,l.jsx)("img",{onClick:q,style:{cursor:"pointer",width:"40px"},src:c.Kh,alt:"print"})]})]})),(0,l.jsxs)("div",Object.assign({className:"print_container box_container mt-2",ref:Y},{children:[(0,l.jsx)("h1",Object.assign({className:"head_title"},{children:"ЖУРНАЛ УЧЕТА ЗАНЯТИЙ"})),Z?(0,l.jsx)("p",Object.assign({className:"text-center mt-4"},{children:"Пока нет данных!"})):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",Object.assign({className:"mt-3 m-l-r-2"},{children:["Преподаватель:"," ",(0,l.jsxs)("strong",{children:[C," ",D," ",P]})]})),(0,l.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Учебный год: ",(0,l.jsx)("strong",{children:N.map((e=>e.id_a_year===y?e.p32:null))})]})),(0,l.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Полугодие/Семестр: ",(0,l.jsx)("strong",{children:z.map((e=>e.id_ws===j?e.ws:null))})]})),(0,l.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Факультет/Группа: ",(0,l.jsx)("strong",{children:e.map((e=>e.id_group===h?e.groups:null))})]})),(0,l.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Дисциплина: ",(0,l.jsx)("strong",{children:g})]})),(0,l.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Вид занятий:"," ",(0,l.jsx)("strong",{children:i.map((e=>e.id_vid_zaniatiy===O?e.name_vid_zaniatiy:null))})]})),(0,l.jsx)("div",Object.assign({className:"mt-4 m-l-r-2 overflow-auto"},{children:(0,l.jsx)("table",Object.assign({className:"table"},{children:(0,l.jsx)("tbody",{children:S.map(((e,i)=>{let t=Object.keys(e);return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("tr",{children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("td",Object.assign({className:"text-center"},{children:i})),t.map(((i,t)=>(0,l.jsx)("td",Object.assign({style:"name"==i?{textAlign:"left",paddingLeft:"10px"}:{textAlign:"center"}},{children:e[i]?e[i]:"-"}),t)))]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("th",Object.assign({className:"bg-color-primary"},{children:"№"})),t.map(((i,t)=>i.includes("date_")?(0,l.jsxs)("th",Object.assign({className:"bg-color-primary"},{children:[" ",(0,l.jsx)("i",{onClick:I.bind(null,e[i]),style:{color:"white",marginRight:"8px"},className:"fa fa-pencil pointer"})," ",e[i]?e[i]:"-"]}),t):(0,l.jsx)("th",Object.assign({className:"bg-color-primary"},{children:e[i]?e[i]:"-"}),t)))]})},i)})}))})}))}))]})]}))]})};var h=function(e,i,t,l){return new(t||(t=Promise))((function(s,a){function n(e){try{d(l.next(e))}catch(e){a(e)}}function u(e){try{d(l.throw(e))}catch(e){a(e)}}function d(e){var i;e.done?s(e.value):(i=e.value,i instanceof t?i:new t((function(e){e(i)}))).then(n,u)}d((l=l.apply(e,i||[])).next())}))};const j=()=>{const{request:e}=(0,u.i)(),i=(0,d.U)(),{id_user:t,id_role:o}=(0,n.X)((e=>e.authReducer)),[c,v]=s.useState([]),[_,g]=s.useState(),[p,j]=s.useState([]),[y,O]=s.useState([]),[f,x]=s.useState([]),[$,S]=s.useState([]),[k,w]=s.useState([]),[N,z]=s.useState(!1),[C,D]=s.useState(!1),[P,Y]=s.useState([]),[M,R]=s.useState({discipline:!1,semester:!1,group:!1,vidZanyatie:!1,student:!1,modal:!1}),[W,V]=s.useState({v_year:{value:null,label:""},v_ws:{value:null,label:""},v_semester:{value:null,label:""},v_group:{value:null,label:""},v_vid_zanyatie:{value:null,label:""},v_amount:{value:null,label:""},v_type_group:{value:null,label:""},v_sub_group:{value:0,label:""},v_otsenka:{value:null,label:""},date:""}),[Z,G]=s.useState(),{years:T}=(0,n.X)((e=>e.yearReducer)),{ws:X}=(0,n.X)((e=>e.wsReducer)),E=(i=0)=>h(void 0,void 0,void 0,(function*(){R(Object.assign(Object.assign({},M),{student:!0}));const{v_year:l,v_group:s,v_semester:a,v_vid_zanyatie:n,v_amount:u,date:d}=W,{data:r}=yield e(`/teacher/student-list?id_year=${l.value}&id_teacher=${t}&id_discipline=${null==_?void 0:_.id_discipline}&isSelect=${null==_?void 0:_.isSelect}&credit=${null==_?void 0:_.Krdt}&id_semester=${a.value}&group=${s.value}&visitDate=${d}&id_vid_zaniatiy=${n.value}&timesCount=${u.value}&subgroup=${i}`);S(r),R(Object.assign(Object.assign({},M),{student:!1}))})),F=()=>h(void 0,void 0,void 0,(function*(){R(Object.assign(Object.assign({},M),{modal:!0}));const{v_year:i,v_group:l,v_semester:s,v_vid_zanyatie:a}=W,{data:n}=yield e(`/teacher/subgroup-students?year=${i.value}&semester=${s.value}&discipline=${null==_?void 0:_.id_discipline}&credit=${null==_?void 0:_.Krdt}&group=${null==l?void 0:l.value}&id_teacher=${t}&id_vid_zaniatiy=${a.value}`);Y(n),R(Object.assign(Object.assign({},M),{modal:!1}))})),K=l=>h(void 0,void 0,void 0,(function*(){const{v_sub_group:s,v_type_group:a}=W,{message:n,type:u}=yield e("/teacher/otsenka","PUT",{id_teacher:t,id_student:null==Z?void 0:Z.id_student,id_discipline:null==Z?void 0:Z.id_discipline,credit:null==Z?void 0:Z.kredits,visitDate:null==Z?void 0:Z.visitDate,isVisited:null==Z?void 0:Z.isVisited,id_groupOrPorok:null==Z?void 0:Z.id_groupOrPorok,isPotok:null==_?void 0:_.isSelect,id_year:null==Z?void 0:Z.id_a_year,id_semesterOrWs:null==Z?void 0:Z.id_semesterOrWs,id_vid_zaniatiy:null==Z?void 0:Z.id_vid_zaniatiy,timesCount:null==Z?void 0:Z.timesCount,id_otsenka:l.value,typeGroup:a.value,subgroup:s.value});i(n,u)}));return s.useEffect((()=>{if(T.length){const{id_a_year:e,p32:i}=T.find((e=>1==e.defaultValue));V(Object.assign(Object.assign({},W),{v_year:{value:e,label:i}}))}}),[T]),C?(0,l.jsx)(m,{groups:y,vidZanyatie:f,credit:null==_?void 0:_.Krdt,isSelect:null==_?void 0:_.isSelect,discipline:null==_?void 0:_.discipline,idDiscipline:null==_?void 0:_.id_discipline,idYear:W.v_year.value,idGroup:W.v_group.value,idVidZanyatie:W.v_vid_zanyatie.value,idWs:W.v_ws.value,back:D.bind(null,!1)}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Eq,{ws:X,years:T,groups:y,loader:M,isModal:N,semester:p,discipline:_,disciplines:c,vidZanyatie:f,studentList:$,valueSelects:W,subgroupStudents:P,changeWs:i=>{V(Object.assign(Object.assign({},W),{v_ws:i,v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_group:{value:null,label:""},v_semester:{value:null,label:""},v_vid_zanyatie:{value:null,label:""},date:"",v_otsenka:{value:null,label:""},v_amount:{value:null,label:""}})),g(void 0),c.length&&v([]),(i=>{h(void 0,void 0,void 0,(function*(){R(Object.assign(Object.assign({},M),{discipline:!0}));const{v_year:l}=W,{data:s}=yield e(`/teacher/discipline?id_year=${l.value}&id_ws=${i}&id_teacher=${t}`);v(s),R(Object.assign(Object.assign({},M),{discipline:!1}))}))})(i.value),p&&j([]),y.length&&O([]),f.length&&x([]),$.length&&S([])},hideModal:()=>{document.body.style.overflowY="visible",z(!1);const{v_sub_group:e}=W;if(e.value)return E(e.value)},showModal:()=>{document.body.style.overflowY="hidden",z(!0),F()},setStudent:G,changeYear:e=>{V({v_year:e,v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_group:{value:null,label:""},v_semester:{value:null,label:""},v_vid_zanyatie:{value:null,label:""},date:"",v_ws:{value:null,label:""},v_otsenka:{value:null,label:""},v_amount:{value:null,label:""}}),g(void 0)},changeDate:t=>{const l=b()(new Date).format("YYYY-MM-DD"),s=b()(t.target.value).format("YYYY-MM-DD");if(s>l)return i("Нельзя выбрать завтрашний день","warn");var a;V(Object.assign(Object.assign({},W),{date:t.target.value,v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_otsenka:{value:null,label:""}})),a=s,h(void 0,void 0,void 0,(function*(){const{data:i}=yield e("/teacher/get-otsenka","POST",{role:o,date:a});w(i)})),$.length&&S([])},changeGroup:i=>{V(Object.assign(Object.assign({},W),{v_group:i,v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_vid_zanyatie:{value:null,label:""},date:"",v_otsenka:{value:null,label:""},v_amount:{value:null,label:""}})),f.length&&x([]),h(void 0,void 0,void 0,(function*(){R(Object.assign(Object.assign({},M),{vidZanyatie:!0}));const{data:i}=yield e("/teacher/vid-zanyatie");x(i),R(Object.assign(Object.assign({},M),{vidZanyatie:!1}))})),$.length&&S([])},setIsReport:D,changeAmount:e=>{V(Object.assign(Object.assign({},W),{v_amount:e,v_type_group:{value:null,label:""}})),$.length&&S([])},changeSemester:i=>{V(Object.assign(Object.assign({},W),{v_semester:i,v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_group:{value:null,label:""},v_vid_zanyatie:{value:null,label:""},date:"",v_otsenka:{value:null,label:""},v_amount:{value:null,label:""}})),y.length&&O([]),(i=>{h(void 0,void 0,void 0,(function*(){R(Object.assign(Object.assign({},M),{group:!0}));const{v_year:l,v_ws:s}=W,{data:a}=yield e(`/teacher/group?id_year=${l.value}&id_ws=${s.value}&id_teacher=${t}&id_discipline=${null==_?void 0:_.id_discipline}&isSelect=${null==_?void 0:_.isSelect}&credit=${null==_?void 0:_.Krdt}&id_semester=${i}`);O(a),R(Object.assign(Object.assign({},M),{group:!1}))}))})(i.value),f.length&&x([]),$.length&&S([])},changeSubGroup:e=>{V(Object.assign(Object.assign({},W),{v_sub_group:e,v_otsenka:{value:null,label:""}})),E(e.value)},changeTypeGroup:e=>{if(e.value)return V(Object.assign(Object.assign({},W),{v_type_group:e})),S([]);V(Object.assign(Object.assign({},W),{v_type_group:e,v_sub_group:{value:null,label:""},v_otsenka:{value:null,label:""}})),E()},changeDiscipline:i=>{const l=c.find((e=>e.discipline===i.value));g(l),V(Object.assign(Object.assign({},W),{v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_group:{value:null,label:""},v_semester:{value:null,label:""},v_vid_zanyatie:{value:null,label:""},date:"",v_otsenka:{value:null,label:""},v_amount:{value:null,label:""}})),p&&j([]),((i,l,s)=>{h(void 0,void 0,void 0,(function*(){R(Object.assign(Object.assign({},M),{semester:!0}));const{v_year:a,v_ws:n}=W,{data:u}=yield e(`/teacher/semester?id_year=${a.value}&id_ws=${n.value}&id_teacher=${t}&id_discipline=${i}&isSelect=${l}&credit=${s}`);j(u),R(Object.assign(Object.assign({},M),{semester:!1}))}))})(null==l?void 0:l.id_discipline,null==l?void 0:l.isSelect,null==l?void 0:l.Krdt),y.length&&O([]),f.length&&x([]),$.length&&S([])},changeVidZanyatie:e=>{V(Object.assign(Object.assign({},W),{v_vid_zanyatie:e,v_sub_group:{value:null,label:""},v_type_group:{value:null,label:""},v_otsenka:{value:null,label:""},v_amount:{value:null,label:""}})),$.length&&S([])},postSubGroupStudent:(l,s,a)=>h(void 0,void 0,void 0,(function*(){const{v_group:n,v_year:u,v_vid_zanyatie:d,v_semester:r}=W,{message:o,type:c}=yield e("/teacher/subgroup","POST",{year:u.value,discipline:null==_?void 0:_.id_discipline,credit:null==_?void 0:_.Krdt,id_teacher:t,id_vid_zaniatiy:d.value,id_semesterOrWs:r.value,id_groupOrPorok:n.value,id_student:l,studentSubgroup:a,subgroup:s});F(),i(o,c)})),PostEveryoneWasPresent:()=>h(void 0,void 0,void 0,(function*(){const{v_type_group:l,v_sub_group:s}=W,{timesCount:a,id_vid_zaniatiy:n,id_discipline:u,id_semesterOrWs:d,id_groupOrPorok:r,isVisited:o,visitDate:c,id_a_year:v,kredits:g}=$[0],{message:b,type:p}=yield e("/teacher/otsenka","POST",{id_teacher:t,id_discipline:u,credit:g,visitDate:c,isVisited:o,id_groupOrPorok:r,isPotok:null==_?void 0:_.isSelect,id_year:v,id_semesterOrWs:d,id_vid_zaniatiy:n,timesCount:a,typeGroup:l.value,subgroup:s.value});i(b,p),E()}))}),M.student?(0,l.jsx)("div",Object.assign({className:"flex justify-content-center mt-2"},{children:(0,l.jsx)(a.aN,{})})):$.length?(0,l.jsx)("div",Object.assign({className:"overflow-auto mt-4 box_container",style:{maxHeight:"900px",minHeight:"400px"}},{children:(0,l.jsxs)("table",Object.assign({className:"table"},{children:[(0,l.jsx)("thead",Object.assign({className:"bg-light"},{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",Object.assign({className:"th"},{children:"№"})),(0,l.jsx)("th",Object.assign({className:"th"},{children:"ФИО"})),(0,l.jsx)("th",Object.assign({className:"th"},{children:"Оценка"}))]})})),(0,l.jsx)("tbody",{children:$.map(((e,i)=>(0,l.jsx)(r.V0,{index:i,item:e,setStudent:G,grade:k,updateOtsenkaApi:K},e.id_student)))})]}))})):(0,l.jsx)("p",Object.assign({className:"text-center mt-4"},{children:"Пока нет данных!"}))]})}},5382:()=>{},2095:()=>{},1219:()=>{}}]);