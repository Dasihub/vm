(self.webpackChunkclient=self.webpackChunkclient||[]).push([[330],{7569:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var i=s(5893),n=s(7294),a=s(1824),l=s(5495),r=s(7116),c=s(927),d=s(7026),o=s(471),u=s(7869),m=s(9948),h=s(7484),j=s.n(h),g=s(1491),p=function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function l(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}c((i=i.apply(e,t||[])).next())}))};const _=({groups:e,vidZanyatie:t,idDiscipline:s,isSelect:l,discipline:h,credit:_,idGroup:x,idWs:v,idYear:f,idVidZanyatie:b,back:y})=>{const{request:O}=(0,c.i)(),N=(0,g.U)(),[S,k]=n.useState([]),{id_user:w}=(0,d.X)((e=>e.authReducer)),{years:$}=(0,d.X)((e=>e.yearReducer)),{ws:C}=(0,d.X)((e=>e.wsReducer)),{surname:R,name:z,patronymic:Z}=(0,d.X)((e=>e.userInfoReducer)),D=n.useRef(null),[F,X]=n.useState([]),[Y,E]=n.useState(!1),[P,G]=n.useState(!1),[M,V]=n.useState(!1),[W,I]=n.useState("");console.log(S,"report");const T=(0,m.t)(F,"dates"),q=()=>p(void 0,void 0,void 0,(function*(){E(!0);const{data:e}=yield O(`/reports/journal?year=${f}&id_ws=${v}&discipline=${s}&credit=${_}&group=${x}&id_teacher=${w}&id_vid_zaniatiy=${b}&isSelect=${l}`);if(E(!1),!e.length)return G(!0);let t=e.reduce(((e,t)=>(e[t.s_fio]=e[t.s_fio]||[],e[t.s_fio].push({date:t.dates,otsenka:t.otsenka,timesCount:t.timesCount}),e)),{}),i=Object.keys(t),n=[],a={item:0,count:0};for(let t=0;t<e.length;t++){let s=e.filter((s=>s.s_fio===e[t].s_fio)).length;s>a.count&&(a={item:e[t],count:e.filter((s=>s.s_fio===e[t].s_fio)).length})}let{item:r,count:c}=a,d={name:"ФИО студента"};for(let e=0;e<c;e++)d["date_"+e]=t[r.s_fio][e].date;d.nb_Count="Всего н/б",d.ball_Count="Общая сумма",d.ball_average="Средняя оценка",n.push(d);for(let s=0;s<i.length;s++){let a={name:i[s]},l=0,d=0,o=null;t[r.s_fio].map(((e,n)=>{o=t[i[s]].filter((t=>t.date==e.date&&t.timesCount==e.timesCount))[0],a["date_"+n]=o?o.otsenka:null}));for(let e=0;e<c;e++)t[i[s]][e]&&("н/б"==t[i[s]][e].otsenka?l+=1:d+=null==t[i[s]][e].otsenka?0:parseInt(t[i[s]][e].otsenka));a.nb_Count=l,a.ball_Count=d,a.ball_average=Math.round(100*d/c)/100,n.push(a),X(e),k(n)}})),A=(0,r.useReactToPrint)({content:()=>D.current}),J=e=>{I(e),V(!0)};return n.useEffect((()=>{z.length&&q()}),[z]),Y?(0,i.jsx)("div",Object.assign({className:"vh-100 flex justify-content-center align-items-center"},{children:(0,i.jsx)(a.aN,{})})):(0,i.jsxs)(i.Fragment,{children:[M&&(0,i.jsx)(a.bZ,{hide:V.bind(null,!1),confirm:()=>p(void 0,void 0,void 0,(function*(){V(!1);const{timesCount:e,id_discipline:t,id_semesterOrWs:s,id_vid_zaniatiy:i,credits:n,visitDate:a}=T[W][0],l=j()(a).format("YYYY-MM-DD"),{data:r}=yield O(`/reports/journal/?id_teacher=${w}&id_discipline=${t}&credit=${n}&visitDate=${l}&id_groupOrPorok=${x}&id_year=${f}&id_ws=${v}&id_semesterOrWs=${s}&id_vid_zaniatiy=${i}&timesCount=${e}`,"DELETE");N(null==r?void 0:r.SMS_T_StudentJournalVisit_delete,"success"),q()}))}),(0,i.jsxs)("div",Object.assign({className:"m-l-r-2 flex align-items-center gap-1"},{children:[(0,i.jsx)("i",{className:"fa-solid fa-arrow-left-long color-primary",onClick:y,style:{cursor:"pointer",fontSize:"30px"}}),P?null:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("img",{onClick:()=>{const e=u.utils.json_to_sheet(S);console.log({ws:e})},style:{cursor:"pointer",width:"40px"},src:o.XO,alt:"exel"}),(0,i.jsx)("img",{onClick:A,style:{cursor:"pointer",width:"40px"},src:o.Kh,alt:"print"})]})]})),(0,i.jsxs)("div",Object.assign({className:"print_container box_container mt-2",ref:D},{children:[(0,i.jsx)("h1",Object.assign({className:"head_title"},{children:"ЖУРНАЛ УЧЕТА ЗАНЯТИЙ"})),P?(0,i.jsx)("p",Object.assign({className:"text-center mt-4"},{children:"Пока нет данных!"})):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",Object.assign({className:"mt-3 m-l-r-2"},{children:["Преподаватель:"," ",(0,i.jsxs)("strong",{children:[R," ",z," ",Z]})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Учебный год: ",(0,i.jsx)("strong",{children:$.map((e=>e.id_a_year===f?e.p32:null))})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Полугодие/Семестр: ",(0,i.jsx)("strong",{children:C.map((e=>e.id_ws===v?e.ws:null))})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Факультет/Группа: ",(0,i.jsx)("strong",{children:e.map((e=>e.id_group===x?e.groups:null))})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Дисциплина: ",(0,i.jsx)("strong",{children:h})]})),(0,i.jsxs)("div",Object.assign({className:"mt-1 m-l-r-2"},{children:["Вид занятий:"," ",(0,i.jsx)("strong",{children:t.map((e=>e.id_vid_zaniatiy===b?e.name_vid_zaniatiy:null))})]})),(0,i.jsx)("div",Object.assign({className:"mt-4 m-l-r-2 overflow-auto"},{children:(0,i.jsx)("table",Object.assign({className:"table"},{children:(0,i.jsx)("tbody",{children:S.map(((e,t)=>{let s=Object.keys(e);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("tr",{children:t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("td",Object.assign({className:"text-center"},{children:t})),s.map(((t,s)=>(0,i.jsx)("td",Object.assign({style:"name"==t?{textAlign:"left",paddingLeft:"10px"}:{textAlign:"center"}},{children:e[t]?e[t]:"-"}),s)))]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("th",Object.assign({className:"bg-color-primary"},{children:"№"})),s.map(((t,s)=>t.includes("date_")?(0,i.jsxs)("th",Object.assign({className:"bg-color-primary"},{children:[" ",(0,i.jsx)("i",{onClick:J.bind(null,e[t]),style:{color:"white",marginRight:"8px"},className:"fa fa-pencil pointer"})," ",e[t]?e[t]:"-"]}),s):(0,i.jsx)("th",Object.assign({className:"bg-color-primary"},{children:e[t]?e[t]:"-"}),s)))]})},t)})}))})}))}))]})]}))]})};var x=s(2724),v=s(6770),f=s(1275),b=s(5998);const y=()=>{const e=(0,b.I0)(),{id_role:t}=(0,d.X)((e=>e.authReducer)),{role1:s}=f.G.actions,[r,c]=n.useState(1),[o,u]=n.useState(!1),[m,h]=n.useState(!1),[j,g]=n.useState(),[p,y]=n.useState({v_year:null,v_group:null,v_vid_zanyatie:null,v_ws:null}),[O,N]=n.useState([]),[S,k]=n.useState([]);return n.useEffect((()=>{1!=t&&e(s())}),[]),m?(0,i.jsx)(_,{groups:O,vidZanyatie:S,credit:null==j?void 0:j.Krdt,isSelect:null==j?void 0:j.isSelect,discipline:null==j?void 0:j.discipline,idDiscipline:null==j?void 0:j.id_discipline,idYear:null==p?void 0:p.v_year,idGroup:null==p?void 0:p.v_group,idVidZanyatie:p.v_vid_zanyatie,idWs:p.v_ws,back:h.bind(null,!1)}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",Object.assign({className:x.Z.tab},{children:(0,i.jsx)(a.mQ,{isPage:r,data:v.qx,changePage:c})})),1==r?(0,i.jsx)(l.J$,{toReport:(e,t)=>{h(!0),y(t),g(e)},vidZanyatie:S,setVidZanyatie:k,groups:O,setGroups:N}):(0,i.jsx)(l.tU,{})]})}},5382:()=>{},2095:()=>{},1219:()=>{}}]);